# AWS Cloud Commander - S3 Features Documentation

## Complete Guide to S3 Integration in Zoho Cliq

---

## Table of Contents

1. [Overview](#overview)
2. [Architecture Diagram](#architecture-diagram)
3. [S3 Features List](#s3-features-list)
4. [Multi-File Upload - Deep Dive](#multi-file-upload---deep-dive)
5. [File Flow Diagrams](#file-flow-diagrams)
6. [Code Walkthrough](#code-walkthrough)
7. [API Reference](#api-reference)
8. [Error Handling](#error-handling)
9. [Security Considerations](#security-considerations)

---

## Overview

AWS Cloud Commander provides a complete S3 management interface directly within Zoho Cliq. Users can browse buckets, upload/download files, search objects, and manage their S3 storage without leaving the chat interface.

### Key Capabilities

| Feature | Description | Max Limit |
|---------|-------------|-----------|
| Browse Buckets | List all S3 buckets with regions | Unlimited |
| **Create Bucket** | Create new S3 bucket in any region | - |
| **Delete Bucket** | Delete empty S3 buckets with confirmation | - |
| Browse Objects | Navigate folders and files | 100 per page |
| Multi-File Upload | Upload multiple files at once | 10 files, 50MB each |
| Download Files | Generate presigned URLs | 1 hour expiry |
| Search Objects | Find files by name pattern | 50 results |
| Delete Objects | Remove files from buckets | 1 at a time |
| Bucket Info | View size, object count, region | - |

---

## Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AWS CLOUD COMMANDER - S3 ARCHITECTURE                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              â”‚     â”‚                  â”‚     â”‚                  â”‚     â”‚         â”‚
â”‚  Zoho Cliq   â”‚â”€â”€â”€â”€â–¶â”‚  Cliq Extension  â”‚â”€â”€â”€â”€â–¶â”‚  Zoho Catalyst   â”‚â”€â”€â”€â”€â–¶â”‚  AWS S3 â”‚
â”‚  (User)      â”‚     â”‚  (Deluge)        â”‚     â”‚  (Node.js)       â”‚     â”‚         â”‚
â”‚              â”‚â—€â”€â”€â”€â”€â”‚                  â”‚â—€â”€â”€â”€â”€â”‚                  â”‚â—€â”€â”€â”€â”€â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                     â”‚                        â”‚                     â”‚
       â”‚                     â”‚                        â”‚                     â”‚
       â–¼                     â–¼                        â–¼                     â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Slash   â”‚         â”‚ Button    â”‚           â”‚ Express    â”‚         â”‚ Buckets  â”‚
  â”‚ Command â”‚         â”‚ Handler   â”‚           â”‚ Router     â”‚         â”‚ Objects  â”‚
  â”‚ /aws s3 â”‚         â”‚ Forms     â”‚           â”‚ /upload    â”‚         â”‚ Presign  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              DATA FLOW LAYERS                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   PRESENTATION        BUSINESS LOGIC         API LAYER          STORAGE     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ Messages â”‚       â”‚ handleButton â”‚      â”‚ index.js  â”‚      â”‚ S3      â”‚  â”‚
â”‚   â”‚ Cards    â”‚â—€â”€â”€â”€â”€â”€â–¶â”‚ handleForm   â”‚â—€â”€â”€â”€â”€â–¶â”‚ s3.js     â”‚â—€â”€â”€â”€â”€â–¶â”‚ Buckets â”‚  â”‚
â”‚   â”‚ Tables   â”‚       â”‚ Execution    â”‚      â”‚ multer    â”‚      â”‚ Objects â”‚  â”‚
â”‚   â”‚ Buttons  â”‚       â”‚ Handler      â”‚      â”‚           â”‚      â”‚         â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## S3 Features List

### 1. List Buckets (`/aws s3`)

Shows all S3 buckets in your AWS account with their regions.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¦ S3 Buckets                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“¦ my-app-bucket      â”‚ us-east-1  â”‚ ğŸ“‚   â”‚
â”‚  ğŸ“¦ backup-storage     â”‚ ap-south-1 â”‚ ğŸ“‚   â”‚
â”‚  ğŸ“¦ logs-archive       â”‚ eu-west-1  â”‚ ğŸ“‚   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ğŸ”„ Refresh]  [â„¹ï¸ Info]  [ğŸ  Dashboard]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Backend Call:**
```javascript
// Service: s3, Action: list
{
    "service": "s3",
    "action": "list",
    "userId": "user123"
}
```

---

### 2. Browse Bucket Contents

Navigate through folders and files within a bucket.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¦ S3 Browser - my-app-bucket/images/                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  FOLDERS                                                    â”‚
â”‚  â”œâ”€â”€ ğŸ“ thumbnails/                              [ğŸ“‚ Open] â”‚
â”‚  â””â”€â”€ ğŸ“ originals/                               [ğŸ“‚ Open] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  FILES                                                      â”‚
â”‚  â”œâ”€â”€ ğŸ“„ logo.png        45 KB    [ğŸ“¥][â„¹ï¸][ğŸ—‘ï¸]             â”‚
â”‚  â”œâ”€â”€ ğŸ“„ banner.jpg      1.2 MB   [ğŸ“¥][â„¹ï¸][ğŸ—‘ï¸]             â”‚
â”‚  â””â”€â”€ ğŸ“„ icon.svg        12 KB    [ğŸ“¥][â„¹ï¸][ğŸ—‘ï¸]             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ğŸ“¤ Upload] [â„¹ï¸ Bucket Info] [ğŸ” Search] [ğŸ“¦ All Buckets] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Backend Call:**
```javascript
// Service: s3, Action: listObjects
{
    "service": "s3",
    "action": "listObjects",
    "bucket": "my-app-bucket",
    "prefix": "images/",
    "userId": "user123"
}
```

---

### 3. Create Bucket

Create a new S3 bucket in any AWS region.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â• Create S3 Bucket                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Bucket Name: [my-new-bucket____________]  â”‚
â”‚                                            â”‚
â”‚  Region: [â–¼ Asia Pacific (Mumbai)      ]   â”‚
â”‚                                            â”‚
â”‚  â„¹ï¸ Bucket names must be globally unique,  â”‚
â”‚  3-63 characters, lowercase letters,       â”‚
â”‚  numbers, and hyphens only.                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ğŸª£ Create Bucket]                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Bucket Naming Rules:**
- Must be 3-63 characters long
- Can only contain lowercase letters, numbers, hyphens, and periods
- Must start and end with a letter or number
- Cannot contain consecutive periods or hyphens next to periods
- Cannot be formatted as an IP address (e.g., 192.168.1.1)
- **Must be globally unique** across all AWS accounts

**Backend Call:**
```javascript
// Service: s3, Action: createBucket
{
    "service": "s3",
    "action": "createBucket",
    "bucket": "my-new-bucket",
    "region": "ap-south-1",
    "userId": "user123"
}
```

---

### 4. Delete Bucket

Delete an empty S3 bucket with confirmation.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ—‘ï¸ Delete Bucket: my-bucket               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âš ï¸ This action cannot be undone!          â”‚
â”‚                                            â”‚
â”‚  Type bucket name to confirm:              â”‚
â”‚  [________________________________]        â”‚
â”‚                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ğŸ—‘ï¸ Delete Bucket]                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Important Notes:**
- Bucket must be **empty** before deletion
- If bucket contains objects, you'll see a warning
- Must type exact bucket name to confirm deletion
- Deletion is **permanent** and cannot be undone

**Non-Empty Bucket Warning:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸ Cannot Delete Bucket                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“¦ Bucket: my-bucket                      â”‚
â”‚  ğŸ“Š Objects: 47 (125.3 MB)                 â”‚
â”‚                                            â”‚
â”‚  âŒ Bucket is not empty!                   â”‚
â”‚                                            â”‚
â”‚  You must delete all objects before        â”‚
â”‚  deleting the bucket.                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ğŸ“‚ Browse Bucket]  [ğŸ“¦ All Buckets]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Backend Call:**
```javascript
// Service: s3, Action: deleteBucket
{
    "service": "s3",
    "action": "deleteBucket",
    "bucket": "my-bucket",
    "userId": "user123"
}
```

---

### 5. Bucket Information

View detailed bucket statistics.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¦ Bucket Info: my-app-bucket             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸŒ Region:        ap-south-1              â”‚
â”‚  ğŸ“Š Total Objects: 1,247                   â”‚
â”‚  ğŸ’¾ Total Size:    2.34 GB                 â”‚
â”‚  ğŸ“… Created:       2024-01-15              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ğŸ“‚ Browse] [ğŸ“¤ Upload] [ğŸ“¦ All Buckets]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 6. File Download (Presigned URL)

Generate a temporary download link valid for 1 hour.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¥ Download Ready                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“„ File: report-2024.pdf                  â”‚
â”‚  ğŸ“¦ Bucket: my-app-bucket                  â”‚
â”‚  â° Link expires in: 1 hour                â”‚
â”‚                                            â”‚
â”‚  ğŸ”— [Click here to download]               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ğŸ“‚ Browse] [ğŸ“¦ All Buckets]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 5. Search Objects

Find files by name pattern across a bucket.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” Search: "report" in my-app-bucket      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Found 5 matching file(s)                  â”‚
â”‚                                            â”‚
â”‚  ğŸ“„ report-2024.pdf      2.1 MB  [ğŸ“¥][â„¹ï¸] â”‚
â”‚  ğŸ“„ report-2023.pdf      1.8 MB  [ğŸ“¥][â„¹ï¸] â”‚
â”‚  ğŸ“„ quarterly-report.docx 500 KB [ğŸ“¥][â„¹ï¸] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ğŸ” Search Again] [ğŸ“‚ Browse] [ğŸ“¦ All]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 6. Delete Object

Remove a file with confirmation.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ—‘ï¸ Delete Confirmation                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Are you sure you want to delete?          â”‚
â”‚                                            â”‚
â”‚  ğŸ“¦ Bucket: my-app-bucket                  â”‚
â”‚  ğŸ“„ File: old-backup.zip                   â”‚
â”‚                                            â”‚
â”‚  âš ï¸ This action cannot be undone!          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ğŸ—‘ï¸ Delete]  [âŒ Cancel]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Multi-File Upload - Deep Dive

### Overview

The multi-file upload feature allows users to upload up to **10 files** (max **50MB each**) to S3 in a single operation. This is implemented using:

1. **Zoho Cliq Form** - Native file input with `multiple=true`
2. **Deluge invokeUrl** - `files` parameter for multipart upload
3. **Express + Multer** - Server-side multipart handling
4. **AWS SDK** - S3 PutObject for each file

---

### Upload Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     MULTI-FILE UPLOAD FLOW                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    USER                    ZOHO CLIQ                 CATALYST              AWS S3
     â”‚                         â”‚                         â”‚                    â”‚
     â”‚  1. Click Upload        â”‚                         â”‚                    â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                         â”‚                    â”‚
     â”‚                         â”‚                         â”‚                    â”‚
     â”‚  2. Show Upload Form    â”‚                         â”‚                    â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                         â”‚                    â”‚
     â”‚                         â”‚                         â”‚                    â”‚
     â”‚  3. Select Files        â”‚                         â”‚                    â”‚
     â”‚   (max 10, 50MB each)   â”‚                         â”‚                    â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                         â”‚                    â”‚
     â”‚                         â”‚                         â”‚                    â”‚
     â”‚                         â”‚  4. Submit Form         â”‚                    â”‚
     â”‚                         â”‚  (multipart/form-data)  â”‚                    â”‚
     â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                    â”‚
     â”‚                         â”‚                         â”‚                    â”‚
     â”‚                         â”‚                         â”‚  5. Upload Each    â”‚
     â”‚                         â”‚                         â”‚     File to S3     â”‚
     â”‚                         â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚                         â”‚                         â”‚                    â”‚
     â”‚                         â”‚                         â”‚  6. Confirm Each   â”‚
     â”‚                         â”‚                         â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                         â”‚                         â”‚                    â”‚
     â”‚                         â”‚  7. Return Results      â”‚                    â”‚
     â”‚                         â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚
     â”‚                         â”‚                         â”‚                    â”‚
     â”‚  8. Show Success        â”‚                         â”‚                    â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                         â”‚                    â”‚
     â”‚                         â”‚                         â”‚                    â”‚


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DETAILED COMPONENT FLOW                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   STEP 1     â”‚    â”‚   STEP 2     â”‚    â”‚   STEP 3     â”‚    â”‚   STEP 4     â”‚
â”‚  Form Show   â”‚â”€â”€â”€â–¶â”‚ File Select  â”‚â”€â”€â”€â–¶â”‚ Form Submit  â”‚â”€â”€â”€â–¶â”‚ Deluge Proc  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                   â”‚                   â”‚
       â–¼                   â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚handleButton  â”‚    â”‚ Zoho Native  â”‚    â”‚ handleForm   â”‚    â”‚ setParamName â”‚
â”‚returns form  â”‚    â”‚ File Picker  â”‚    â”‚ receives     â”‚    â”‚ for each     â”‚
â”‚with file     â”‚    â”‚ validates:   â”‚    â”‚ filesData    â”‚    â”‚ file object  â”‚
â”‚input config  â”‚    â”‚ - max 10     â”‚    â”‚ as List      â”‚    â”‚              â”‚
â”‚              â”‚    â”‚ - max 50MB   â”‚    â”‚              â”‚    â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                   â”‚
                                                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   STEP 8     â”‚    â”‚   STEP 7     â”‚    â”‚   STEP 6     â”‚    â”‚   STEP 5     â”‚
â”‚  Show Rslt   â”‚â—€â”€â”€â”€â”‚ Parse Resp   â”‚â—€â”€â”€â”€â”‚ Upload Loop  â”‚â—€â”€â”€â”€â”‚ invokeUrl    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                   â”‚                   â”‚
       â–¼                   â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Success msg  â”‚    â”‚ Extract:     â”‚    â”‚ For each     â”‚    â”‚ POST to      â”‚
â”‚ with list of â”‚    â”‚ - uploaded[] â”‚    â”‚ file:        â”‚    â”‚ /upload      â”‚
â”‚ files and    â”‚    â”‚ - errors[]   â”‚    â”‚ PutObject    â”‚    â”‚ with files   â”‚
â”‚ their sizes  â”‚    â”‚ - counts     â”‚    â”‚ to S3        â”‚    â”‚ parameter    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Form Configuration

The upload form uses Zoho Cliq's native file input with these settings:

```javascript
// handleButton.ds - Upload Form Definition
{
    "type": "file",
    "name": "files",                    // Field name (matches multer config)
    "label": "Select Files",
    "placeholder": "Choose files to upload (max 10)",
    "mandatory": true,
    "multiple": true,                   // Allow multiple selection
    "max_selections": 10,               // Maximum 10 files
    "max_size": 51200                   // 50MB in KB (50 * 1024)
}
```

**Form Attributes Explained:**

| Attribute | Value | Purpose |
|-----------|-------|---------|
| `type` | `"file"` | Native file picker |
| `name` | `"files"` | Key in form values |
| `multiple` | `true` | Enable multi-select |
| `max_selections` | `10` | Limit to 10 files |
| `max_size` | `51200` | 50MB limit per file (in KB) |

---

### Deluge Processing (handleForm.ds)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DELUGE FILE PROCESSING                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  Form Submit    â”‚
                              â”‚  formName =     â”‚
                              â”‚  "s3_upload"    â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  Get Form Data  â”‚
                              â”‚  bucket, prefix â”‚
                              â”‚  filesData      â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  filesData is   â”‚
                              â”‚  a List (when   â”‚
                              â”‚  multiple=true) â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                  â”‚                  â”‚
                    â–¼                  â–¼                  â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚   File 1     â”‚   â”‚   File 2     â”‚   â”‚   File N     â”‚
           â”‚ setParamName â”‚   â”‚ setParamName â”‚   â”‚ setParamName â”‚
           â”‚   ("files")  â”‚   â”‚   ("files")  â”‚   â”‚   ("files")  â”‚
           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                  â”‚                  â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚  Add Metadata   â”‚
                            â”‚  as StringPart  â”‚
                            â”‚  {userId,       â”‚
                            â”‚   bucket,       â”‚
                            â”‚   prefix}       â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚   invokeUrl     â”‚
                            â”‚   POST /upload  â”‚
                            â”‚   files: list   â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key Code:**

```deluge
// Get files from form (always a List when multiple=true)
filesData = formValues.get("files");

// Create file list for multipart upload
fileList = List();

// Get file count
fileCount = filesData.size();

// Add each file with the correct param name
for each fileItem in filesData
{
    fileItem.setParamName("files");  // CRITICAL: Must match multer field name
    fileList.add(fileItem);
}

// Add metadata as a string part
metaData = Map();
metaData.put("userId", userId);
metaData.put("bucket", bucket);
metaData.put("prefix", prefix);

metaPart = Map();
metaPart.put("stringPart", "true");
metaPart.put("paramName", "metadata");
metaPart.put("content", metaData.toString());
metaPart.put("contentType", "application/json");
fileList.add(metaPart);

// Send multipart request
apiResponse = invokeurl
[
    url: UPLOAD_URL
    type: POST
    files: fileList
    connection: "awscloudcommander"
];
```

---

### Backend Processing (index.js)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EXPRESS + MULTER PROCESSING                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        HTTP POST /upload
        Content-Type: multipart/form-data
               â”‚
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Multer Middleware  â”‚
    â”‚  upload.array(      â”‚
    â”‚    'files', 10      â”‚  â—€â”€â”€ Field name must match setParamName
    â”‚  )                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Parse Request      â”‚
    â”‚  req.files = [      â”‚
    â”‚    {buffer, name},  â”‚
    â”‚    {buffer, name},  â”‚
    â”‚    ...              â”‚
    â”‚  ]                  â”‚
    â”‚  req.body.metadata  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Validate           â”‚
    â”‚  - Files exist?     â”‚
    â”‚  - Bucket provided? â”‚
    â”‚  - Size < 50MB?     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Upload Loop        â”‚
    â”‚  for each file:     â”‚
    â”‚    s3.uploadObject( â”‚
    â”‚      bucket,        â”‚
    â”‚      prefix + name, â”‚
    â”‚      file.buffer,   â”‚
    â”‚      mimetype       â”‚
    â”‚    )                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                     â”‚
    â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Success â”‚         â”‚ Error   â”‚
â”‚ Track   â”‚         â”‚ Track   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚                   â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Return Response    â”‚
    â”‚  {                  â”‚
    â”‚    successCount,    â”‚
    â”‚    failCount,       â”‚
    â”‚    uploaded: [...], â”‚
    â”‚    errors: [...]    â”‚
    â”‚  }                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key Code:**

```javascript
// Multer configuration
const upload = multer({
    storage: multer.memoryStorage(),  // Keep files in memory (buffer)
    limits: {
        fileSize: 50 * 1024 * 1024    // 50MB limit
    }
});

// Route handler
app.post('/upload', upload.array('files', 10), async (req, res) => {
    const files = req.files;           // Array of file objects
    const metadata = JSON.parse(req.body.metadata);

    const uploadResults = [];
    const errors = [];

    for (const file of files) {
        try {
            // Build S3 key: prefix + original filename
            let s3Key = file.originalname;
            if (metadata.prefix) {
                s3Key = metadata.prefix + file.originalname;
            }

            // Upload to S3
            await s3Service.uploadObject(
                metadata.bucket,
                s3Key,
                file.buffer,      // File content as Buffer
                file.mimetype,    // Content type
                region
            );

            uploadResults.push({
                fileName: file.originalname,
                key: s3Key,
                size: file.size,
                sizeFormatted: formatBytes(file.size),
                uploaded: true
            });
        } catch (err) {
            errors.push({
                fileName: file.originalname,
                error: err.message
            });
        }
    }

    res.json({
        success: true,
        data: {
            totalFiles: files.length,
            successCount: uploadResults.length,
            failCount: errors.length,
            uploaded: uploadResults,
            errors: errors.length > 0 ? errors : undefined
        }
    });
});
```

---

### S3 Upload (s3.js)

```javascript
/**
 * Upload an object to S3
 */
async function uploadObject(bucketName, key, body, contentType, region) {
    const client = getS3Client(region);

    await client.send(new PutObjectCommand({
        Bucket: bucketName,
        Key: key,
        Body: body,                    // Buffer from multer
        ContentType: contentType       // MIME type
    }));

    return {
        bucket: bucketName,
        key: key,
        uploaded: true,
        message: `File uploaded to ${bucketName}/${key}`
    };
}
```

---

## File Flow Diagrams

### Complete Request/Response Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    COMPLETE UPLOAD REQUEST/RESPONSE                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

USER SELECTS 3 FILES:
â”œâ”€â”€ document.pdf (2.1 MB)
â”œâ”€â”€ image.png (500 KB)
â””â”€â”€ data.csv (150 KB)

                    REQUEST
                    â•â•â•â•â•â•â•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /upload HTTP/1.1                                                        â”‚
â”‚ Content-Type: multipart/form-data; boundary=----WebKitFormBoundary          â”‚
â”‚                                                                              â”‚
â”‚ ------WebKitFormBoundary                                                     â”‚
â”‚ Content-Disposition: form-data; name="files"; filename="document.pdf"        â”‚
â”‚ Content-Type: application/pdf                                                â”‚
â”‚                                                                              â”‚
â”‚ [Binary content of document.pdf - 2.1 MB]                                    â”‚
â”‚                                                                              â”‚
â”‚ ------WebKitFormBoundary                                                     â”‚
â”‚ Content-Disposition: form-data; name="files"; filename="image.png"           â”‚
â”‚ Content-Type: image/png                                                      â”‚
â”‚                                                                              â”‚
â”‚ [Binary content of image.png - 500 KB]                                       â”‚
â”‚                                                                              â”‚
â”‚ ------WebKitFormBoundary                                                     â”‚
â”‚ Content-Disposition: form-data; name="files"; filename="data.csv"            â”‚
â”‚ Content-Type: text/csv                                                       â”‚
â”‚                                                                              â”‚
â”‚ [Binary content of data.csv - 150 KB]                                        â”‚
â”‚                                                                              â”‚
â”‚ ------WebKitFormBoundary                                                     â”‚
â”‚ Content-Disposition: form-data; name="metadata"                              â”‚
â”‚ Content-Type: application/json                                               â”‚
â”‚                                                                              â”‚
â”‚ {"userId":"user123","bucket":"my-bucket","prefix":"uploads/"}                â”‚
â”‚                                                                              â”‚
â”‚ ------WebKitFormBoundary--                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


                    RESPONSE
                    â•â•â•â•â•â•â•â•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HTTP/1.1 200 OK                                                              â”‚
â”‚ Content-Type: application/json                                               â”‚
â”‚                                                                              â”‚
â”‚ {                                                                            â”‚
â”‚   "success": true,                                                           â”‚
â”‚   "data": {                                                                  â”‚
â”‚     "bucket": "my-bucket",                                                   â”‚
â”‚     "prefix": "uploads/",                                                    â”‚
â”‚     "totalFiles": 3,                                                         â”‚
â”‚     "successCount": 3,                                                       â”‚
â”‚     "failCount": 0,                                                          â”‚
â”‚     "uploaded": [                                                            â”‚
â”‚       {                                                                      â”‚
â”‚         "fileName": "document.pdf",                                          â”‚
â”‚         "key": "uploads/document.pdf",                                       â”‚
â”‚         "size": 2202009,                                                     â”‚
â”‚         "sizeFormatted": "2.1 MB",                                           â”‚
â”‚         "uploaded": true                                                     â”‚
â”‚       },                                                                     â”‚
â”‚       {                                                                      â”‚
â”‚         "fileName": "image.png",                                             â”‚
â”‚         "key": "uploads/image.png",                                          â”‚
â”‚         "size": 512000,                                                      â”‚
â”‚         "sizeFormatted": "500 KB",                                           â”‚
â”‚         "uploaded": true                                                     â”‚
â”‚       },                                                                     â”‚
â”‚       {                                                                      â”‚
â”‚         "fileName": "data.csv",                                              â”‚
â”‚         "key": "uploads/data.csv",                                           â”‚
â”‚         "size": 153600,                                                      â”‚
â”‚         "sizeFormatted": "150 KB",                                           â”‚
â”‚         "uploaded": true                                                     â”‚
â”‚       }                                                                      â”‚
â”‚     ]                                                                        â”‚
â”‚   }                                                                          â”‚
â”‚ }                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


                    USER SEES
                    â•â•â•â•â•â•â•â•â•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… S3 Upload Complete                                                       â”‚
â”‚                                                                              â”‚
â”‚  ğŸ“¦ Bucket: my-bucket                                                        â”‚
â”‚  ğŸ“ Folder: uploads/                                                         â”‚
â”‚                                                                              â”‚
â”‚  Results: 3/3 files uploaded                                                 â”‚
â”‚                                                                              â”‚
â”‚  âœ… document.pdf (2.1 MB)                                                    â”‚
â”‚  âœ… image.png (500 KB)                                                       â”‚
â”‚  âœ… data.csv (150 KB)                                                        â”‚
â”‚                                                                              â”‚
â”‚  [ğŸ“¦ Browse Bucket]  [ğŸ“¤ Upload More]                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Partial Failure Handling

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PARTIAL FAILURE SCENARIO                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

USER UPLOADS 3 FILES, 1 FAILS:
â”œâ”€â”€ document.pdf â”€â”€â”€â”€â”€â”€â–¶ âœ… Success (uploaded)
â”œâ”€â”€ huge-file.zip â”€â”€â”€â”€â”€â–¶ âŒ Failed (exceeds quota)
â””â”€â”€ data.csv â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ âœ… Success (uploaded)

RESPONSE:
{
  "success": true,
  "data": {
    "totalFiles": 3,
    "successCount": 2,
    "failCount": 1,
    "uploaded": [
      {"fileName": "document.pdf", "uploaded": true},
      {"fileName": "data.csv", "uploaded": true}
    ],
    "errors": [
      {"fileName": "huge-file.zip", "error": "Access Denied"}
    ]
  }
}

USER SEES:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… S3 Upload Complete                                                       â”‚
â”‚                                                                              â”‚
â”‚  ğŸ“¦ Bucket: my-bucket                                                        â”‚
â”‚                                                                              â”‚
â”‚  Results: 2/3 files uploaded                                                 â”‚
â”‚                                                                              â”‚
â”‚  âœ… document.pdf (2.1 MB)                                                    â”‚
â”‚  âœ… data.csv (150 KB)                                                        â”‚
â”‚                                                                              â”‚
â”‚  âš ï¸ Failed:                                                                  â”‚
â”‚  âŒ huge-file.zip: Access Denied                                             â”‚
â”‚                                                                              â”‚
â”‚  [ğŸ“¦ Browse Bucket]  [ğŸ“¤ Upload More]                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## API Reference

### S3 Service Endpoints

| Action | Description | Parameters |
|--------|-------------|------------|
| `listBuckets` | List all buckets | - |
| `createBucket` | Create new bucket | `bucket`, `region` |
| `deleteBucket` | Delete empty bucket | `bucket` |
| `listObjects` | List bucket contents | `bucket`, `prefix` |
| `getBucket` | Get bucket info | `bucket` |
| `getObject` | Get object metadata | `bucket`, `key` |
| `getPresignedUrl` | Get download URL | `bucket`, `key` |
| `search` | Search objects | `bucket`, `searchTerm` |
| `deleteObject` | Delete object | `bucket`, `key` |
| `uploadFile` | Upload file(s) | `bucket`, `prefix`, `files` |

### Upload Endpoint

**URL:** `POST /upload`

**Content-Type:** `multipart/form-data`

**Fields:**
| Field | Type | Description |
|-------|------|-------------|
| `files` | File(s) | Up to 10 files, max 50MB each |
| `metadata` | JSON String | `{userId, bucket, prefix}` |

**Response:**
```typescript
{
  success: boolean;
  data: {
    bucket: string;
    prefix: string;
    totalFiles: number;
    successCount: number;
    failCount: number;
    uploaded: Array<{
      fileName: string;
      key: string;
      size: number;
      sizeFormatted: string;
      uploaded: boolean;
    }>;
    errors?: Array<{
      fileName: string;
      error: string;
    }>;
  }
}
```

---

## Error Handling

### Client-Side Validation (Zoho Cliq)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Zoho Cliq validates BEFORE form submission:                                 â”‚
â”‚                                                                              â”‚
â”‚  1. max_selections: 10                                                       â”‚
â”‚     â””â”€â”€ "You can select up to 10 files"                                      â”‚
â”‚                                                                              â”‚
â”‚  2. max_size: 51200 (50MB in KB)                                             â”‚
â”‚     â””â”€â”€ "File exceeds maximum size limit"                                    â”‚
â”‚                                                                              â”‚
â”‚  These errors appear IMMEDIATELY when selecting files                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Server-Side Validation (Express)

```javascript
// Multer file size limit
const upload = multer({
    limits: { fileSize: 50 * 1024 * 1024 }
});
// Throws: "File too large" if exceeded

// Manual validation in route
if (!files || files.length === 0) {
    return res.status(400).json(errorResponse('No files uploaded'));
}

if (!bucket) {
    return res.status(400).json(errorResponse('Bucket is required'));
}
```

### S3 Upload Errors

| Error | Cause | Solution |
|-------|-------|----------|
| `AccessDenied` | IAM permissions | Add `s3:PutObject` permission |
| `NoSuchBucket` | Bucket doesn't exist | Check bucket name |
| `InvalidBucketName` | Invalid characters | Use valid bucket name |
| `EntityTooLarge` | File too big | Reduce file size |

---

## Security Considerations

### IAM Permissions Required

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "s3:ListAllMyBuckets",
                "s3:GetBucketLocation"
            ],
            "Resource": "*"
        },
        {
            "Effect": "Allow",
            "Action": [
                "s3:ListBucket",
                "s3:GetObject",
                "s3:PutObject",
                "s3:DeleteObject"
            ],
            "Resource": [
                "arn:aws:s3:::your-bucket-name",
                "arn:aws:s3:::your-bucket-name/*"
            ]
        }
    ]
}
```

### File Validation

1. **Size Limits** - Enforced at 3 levels:
   - Zoho Cliq form (`max_size: 51200`)
   - Multer middleware (`fileSize: 50MB`)
   - S3 service (`MAX_FILE_SIZE`)

2. **File Names** - Original names preserved, sanitization handled by S3

3. **Content Types** - Detected by Multer, passed to S3

### Connection Security

- All communication over HTTPS
- Zoho Catalyst Connection used for authentication
- AWS credentials stored in Catalyst environment variables

---

## FAQ: How Does File Upload Actually Work?

### Q: "So you mean I'm literally sending raw files and their metadata through HTTP and then receiving those in the req object and passing them to S3?"

**A: Yes! That's exactly what's happening.** Here's the journey of your file bytes:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    THE JOURNEY OF YOUR FILE BYTES                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  YOUR COMPUTER                 INTERNET                    AWS
       â”‚                           â”‚                          â”‚
       â–¼                           â”‚                          â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚                          â”‚
  â”‚ Raw     â”‚   Binary Data        â”‚                          â”‚
  â”‚ Bytes   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–¶  â”‚
  â”‚ of File â”‚   Over HTTP          â”‚                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚                          â–¼
       â”‚                           â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                           â”‚                     â”‚ S3      â”‚
       â”‚                           â”‚                     â”‚ Stored! â”‚
       â”‚                           â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    HTTP POST        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    AWS SDK      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  
â”‚Zoho Cliqâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚Your Serverâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶|   AWS S3   |
â”‚(Browser)â”‚ multipart/form-data â”‚(Node.js) â”‚ PutObjectCommand  |   (Cloud)  |
â”‚         â”‚  [raw file bytes]   â”‚          â”‚   [buffer]        |            |
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            
```

### The Complete Byte Journey

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: Your Browser                                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                        â”‚
â”‚                                                                              â”‚
â”‚  You select a file. The browser reads it as raw bytes.                       â”‚
â”‚                                                                              â”‚
â”‚  report.pdf â†’ [0x25, 0x50, 0x44, 0x46, 0x2d, 0x31, 0x2e, ...]               â”‚
â”‚               (These are the actual bytes - %PDF-1... in ASCII)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: Zoho Cliq Form                                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                      â”‚
â”‚                                                                              â”‚
â”‚  Cliq packages the raw bytes into a form submission.                         â”‚
â”‚  The file object contains the actual binary data.                            â”‚
â”‚                                                                              â”‚
â”‚  form.values.files = [                                                       â”‚
â”‚    { name: "report.pdf", bytes: [raw binary data], type: "application/pdf" } â”‚
â”‚  ]                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 3: Deluge invokeUrl (with files parameter)                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                             â”‚
â”‚                                                                              â”‚
â”‚  When you use `invokeUrl` with `files:` parameter, Deluge:                   â”‚
â”‚                                                                              â”‚
â”‚  1. Creates a multipart/form-data HTTP request                               â”‚
â”‚  2. Embeds the RAW BYTES directly in the HTTP body                           â”‚
â”‚  3. Adds boundaries to separate multiple files                               â”‚
â”‚                                                                              â”‚
â”‚  The HTTP request literally contains your file's bytes:                      â”‚
â”‚                                                                              â”‚
â”‚  POST /upload HTTP/1.1                                                       â”‚
â”‚  Content-Type: multipart/form-data; boundary=----abc123                      â”‚
â”‚                                                                              â”‚
â”‚  ------abc123                                                                â”‚
â”‚  Content-Disposition: form-data; name="files"; filename="report.pdf"         â”‚
â”‚  Content-Type: application/pdf                                               â”‚
â”‚                                                                              â”‚
â”‚  %PDF-1.4... [ACTUAL FILE BYTES HERE - could be megabytes of data!]          â”‚
â”‚                                                                              â”‚
â”‚  ------abc123--                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 4: Express + Multer (receives the bytes)                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                               â”‚
â”‚                                                                              â”‚
â”‚  Multer middleware intercepts the request and:                               â”‚
â”‚                                                                              â”‚
â”‚  1. Parses the multipart boundaries                                          â”‚
â”‚  2. Extracts the raw bytes from each file section                            â”‚
â”‚  3. Stores them in memory as a Buffer                                        â”‚
â”‚                                                                              â”‚
â”‚  req.files = [                                                               â”‚
â”‚    {                                                                         â”‚
â”‚      fieldname: 'files',                                                     â”‚
â”‚      originalname: 'report.pdf',                                             â”‚
â”‚      mimetype: 'application/pdf',                                            â”‚
â”‚      buffer: <Buffer 25 50 44 46 2d 31 2e ...>,  â—€â”€â”€ YOUR RAW BYTES!         â”‚
â”‚      size: 2150400                                                           â”‚
â”‚    }                                                                         â”‚
â”‚  ]                                                                           â”‚
â”‚                                                                              â”‚
â”‚  The `buffer` property contains the EXACT SAME BYTES as your original file!  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 5: S3 Upload (bytes to the cloud)                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      â”‚
â”‚                                                                              â”‚
â”‚  We pass the buffer directly to AWS S3:                                      â”‚
â”‚                                                                              â”‚
â”‚  await client.send(new PutObjectCommand({                                    â”‚
â”‚      Bucket: 'my-bucket',                                                    â”‚
â”‚      Key: 'uploads/report.pdf',                                              â”‚
â”‚      Body: file.buffer,        â—€â”€â”€ Same raw bytes, passed to S3              â”‚
â”‚      ContentType: 'application/pdf'                                          â”‚
â”‚  }));                                                                        â”‚
â”‚                                                                              â”‚
â”‚  S3 receives and stores those exact bytes.                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 6: File Stored in S3!                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                  â”‚
â”‚                                                                              â”‚
â”‚  Your file is now in S3 with the EXACT SAME bytes.                           â”‚
â”‚  If you download it, you'll get the identical file.                          â”‚
â”‚                                                                              â”‚
â”‚  Original file:  report.pdf (2.1 MB) â†’ [bytes...]                            â”‚
â”‚  S3 stored file: report.pdf (2.1 MB) â†’ [same bytes...]                       â”‚
â”‚                                                                              â”‚
â”‚  âœ… Byte-for-byte identical!                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
# No temporary files on disk - everything stays in memory (multer.memoryStorage()), which is fast but means you need enough RAM for the files being uploaded (hence the 50MB limit).

### Summary: The Simple Truth

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                              â”‚
â”‚   Raw bytes     Raw bytes        Raw bytes         Raw bytes      File       â”‚
â”‚   in browser    over HTTP        in Node.js        to S3          stored!    â”‚
â”‚                 (multipart)      memory (Buffer)                             â”‚
â”‚       â”‚              â”‚                â”‚                â”‚             â”‚       â”‚
â”‚       â–¼              â–¼                â–¼                â–¼             â–¼       â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”    â”‚
â”‚    â”‚ ğŸ“„  â”‚ â•â•â•â•â–¶ â”‚ ğŸŒ  â”‚ â•â•â•â•â•â•â•â•â–¶â”‚ ğŸ’¾  â”‚ â•â•â•â•â•â•â•â•â–¶â”‚ â˜ï¸  â”‚ â•â•â•â•â–¶â”‚ âœ…  â”‚    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚   The file's raw bytes travel through the entire system unchanged.           â”‚
â”‚   No encoding, no conversion - just pure binary data moving through pipes.   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Why This Works

1. **HTTP supports binary data** - The `multipart/form-data` content type was designed specifically for file uploads

2. **No encoding needed** - Unlike JSON (which is text), multipart allows raw binary

3. **Memory efficient** - We use `memoryStorage()` in Multer to keep files as Buffers (raw bytes in RAM)

4. **Direct passthrough** - The same bytes that leave your browser are the same bytes that get stored in S3

### What's NOT Happening

- âŒ Files are NOT converted to Base64 (that would increase size by 33%)
- âŒ Files are NOT written to disk (we use memory storage)
- âŒ Files are NOT modified or re-encoded
- âŒ No compression or decompression happens

**It's literally just moving bytes from Point A to Point B!**

---

## Files Reference

| File | Purpose |
|------|---------|
| `handleButton.ds` | S3 UI handlers - bucket list, browse, upload form, create/delete bucket forms |
| `handleForm.ds` | Form handlers for upload, search, create bucket, delete bucket |
| `server/index.js` | Express routes - S3 actions including createBucket, deleteBucket |
| `server/services/s3.js` | S3 operations - all AWS SDK interactions |

### Key Functions in s3.js

| Function | Description |
|----------|-------------|
| `listBuckets(region)` | List all S3 buckets with regions |
| `createBucket(bucketName, region)` | Create new bucket with validation |
| `deleteBucket(bucketName, region)` | Delete empty bucket |
| `getBucketInfo(bucketName, region)` | Get bucket stats (size, count) |
| `listObjects(bucket, prefix, region)` | List folder contents |
| `uploadObject(bucket, key, body, contentType, region)` | Upload file to S3 |
| `getPresignedUrl(bucket, key, region)` | Generate download URL |
| `deleteObject(bucket, key, region)` | Delete single object |
| `searchObjects(bucket, searchTerm, region)` | Search files by name |

---

*Last Updated: November 2025*
*AWS Cloud Commander - Zoho Cliq Extension*
